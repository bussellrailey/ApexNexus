<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT-2 Chat Bot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #chatWindow {
            height: 400px;
            border: 1px solid #ccc;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
        }
        #userInput {
            width: 80%;
            padding: 5px;
        }
        #sendButton {
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div id="chatWindow"></div>
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="sendButton">Send</button>

    <script>
        const chatWindow = document.getElementById('chatWindow');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        
        const apiKey = 'your-api-key';  // Replace with your actual API key
        const modelName = 'your-gpt-2-model';  // Replace with your GPT-2 model name

        function addMessage(sender, message) {
            const messageElement = document.createElement('p');
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function isValidURL(message) {
            const pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|'+ // domain name
                '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
                '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
                '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
            return !!pattern.test(message);
        }

        function handleCountdown(message) {
            const countDownMatch = message.match(/count\s*(down|up)\s*from\s*(-?\d+)\s*(and\s*stop\s*(at|on)\s*(-?\d+))?/i);
            if (countDownMatch) {
                const direction = countDownMatch[1].toLowerCase();
                const start = parseInt(countDownMatch[2]);
                const stop = parseInt(countDownMatch[5]) || (direction === 'down' ? 0 : 10); // default stop

                let count = [];
                if (direction === 'down') {
                    for (let i = start; i >= stop; i--) {
                        count.push(i);
                    }
                } else {
                    for (let i = start; i <= stop; i++) {
                        count.push(i);
                    }
                }
                return count.join(', ');
            }
            return null;
        }

        async function botResponse(message) {
    if (isValidURL(message)) {
        // Handle URL extraction via backend API
        try {
            const response = await fetch(`https://your-api-endpoint/extract-url`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`  // Ensure apiKey is set
                },
                body: JSON.stringify({ url: message })
            });

            if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
            }

            const data = await response.json();
            return data.summary || "I couldn't find any useful information on that page.";
        } catch (error) {
            console.error('Error fetching URL summary:', error);
            return "I'm sorry, I couldn't process the URL provided. Please check the link.";
        }
    } else {
        // GPT-2 standard response
        try {
            const response = await fetch(`https://your-api-endpoint/generate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`  // Ensure apiKey is set
                },
                body: JSON.stringify({ 
                    model: modelName,
                    input: message 
                })
            });

            if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
            }

            const data = await response.json();

            // Improved error handling for repetitive or empty responses
            if (!data.response || data.response.toLowerCase().includes('error') || data.response.trim() === message.trim()) {
                return "I'm not sure I understand. Could you phrase it differently?";
            }

            return data.response;
        } catch (error) {
            console.error('Error fetching GPT-2 response:', error);
            return "I encountered an error while processing your request. Please try again in a moment.";
        }
    }
}

function handleUserInput() {
    const message = userInput.value.trim();
    if (message) {
        addMessage('You', message);
        userInput.value = '';

        setTimeout(async () => {
            let response = '';
            
            // Check if the input is something the bot can handle directly
            if (message.toLowerCase().includes('hello')) {
                response = 'Hello! How can I assist you today?';
            } else if (message.toLowerCase().includes('your name')) {
                response = "I'm your friendly chatbot!";
            } else if (message.toLowerCase().includes('help')) {
                response = "You can ask me to perform basic tasks like counting, simple math, or even exploring URLs.";
            } else if (message.toLowerCase().includes('capabilities')) {
                response = "I can chat, count down or up, and handle basic arithmetic! Just let me know what youâ€™d like to try.";
            } else if (message.toLowerCase().includes('alphabet')) {
                response = "The alphabet starts with A, B, C...and goes all the way to Z!";
            } else if (message.toLowerCase().match(/(\d+)\s*\*\s*(\d+)/)) {
                const [_, num1, num2] = message.match(/(\d+)\s*\*\s*(\d+)/);
                response = `${num1} * ${num2} = ${num1 * num2}`;
            } else if (message.toLowerCase().includes('square root')) {
                const match = message.match(/square root of (\d+)/);
                if (match) {
                    const number = parseInt(match[1], 10);
                    response = `The square root of ${number} is approximately ${Math.sqrt(number).toFixed(2)}`;
                } else {
                    response = "I can't calculate that. Try 'square root of [number]'.";
                }
            } else if (message.toLowerCase().includes('system info')) {
                response = await systemInfoRequest();
            } else {
                // Custom countdown handler
                const countdownResult = handleCountdown(message);
                if (countdownResult) {
                    response = countdownResult;
                } else {
                    // Send to GPT-2 model for further processing
                    response = await botResponse(message);
                }
            }

            addMessage('Bot', response);
        }, 500);
    }
}
      

        sendButton.addEventListener('click', handleUserInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleUserInput();
            }
        });
    </script>
</body>
</html>
