<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT-2 Chat Bot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        #chatWindow {
            height: 400px;
            border: 1px solid #ccc;
            overflow-y: auto;
            padding: 10px;
            margin-bottom: 10px;
        }
        #userInput {
            width: 80%;
            padding: 5px;
        }
        #sendButton {
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div id="chatWindow"></div>
    <input type="text" id="userInput" placeholder="Type your message...">
    <button id="sendButton">Send</button>

    <script>
        const chatWindow = document.getElementById('chatWindow');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        
        const apiKey = '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';  // API key for integration
        const modelName = 'gpt-2';  // Replace with your GPT-2 model name if needed

        // Memory setup
        const memory = {
            userMessages: [],
            botResponses: []
        };
        const MEMORY_LIMIT = 5;

        function addToMemory(userMessage, botResponse) {
            memory.userMessages.push(userMessage);
            memory.botResponses.push(botResponse);

            if (memory.userMessages.length > MEMORY_LIMIT) memory.userMessages.shift();
            if (memory.botResponses.length > MEMORY_LIMIT) memory.botResponses.shift();
        }

        function recallMemory() {
            let recentUser = memory.userMessages.slice(-2).join(' | ');
            let recentBot = memory.botResponses.slice(-2).join(' | ');
            return `You recently mentioned: "${recentUser}" and I said: "${recentBot}".`;
        }

        function addMessage(sender, message) {
            const messageElement = document.createElement('p');
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function isValidURL(message) {
            const pattern = new RegExp('^(https?:\\/\\/)?'+
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|'+ 
                '((\\d{1,3}\\.){3}\\d{1,3}))'+
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ 
                '(\\?[;&a-z\\d%_.~+=-]*)?'+ 
                '(\\#[-a-z\\d_]*)?$','i');
            return !!pattern.test(message);
        }

        function handleCountdown(message) {
            const countDownMatch = message.match(/count\s*(down|up)\s*from\s*(-?\d+)\s*(and\s*stop\s*(at|on)\s*(-?\d+))?/i);
            if (countDownMatch) {
                const direction = countDownMatch[1].toLowerCase();
                const start = parseInt(countDownMatch[2]);
                const stop = parseInt(countDownMatch[5]) || (direction === 'down' ? 0 : 10);

                let count = [];
                if (direction === 'down') {
                    for (let i = start; i >= stop; i--) {
                        count.push(i);
                    }
                } else {
                    for (let i = start; i <= stop; i++) {
                        count.push(i);
                    }
                }
                return count.join(', ');
            }
            return null;
        }
        
  async function botResponse(message) {
    try {
        const response = await fetch(`https://your-api-endpoint/generate`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({ 
                model: modelName,
                input: message 
            })
        });

        if (!response.ok) {
            throw new Error(`API error: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();

        if (!data.response || data.response.toLowerCase().includes('error')) {
            return "I couldn't understand that request. Can you try asking differently?";
        }

        return data.response;
    } catch (error) {
        console.error('Error in bot response:', error);
        return "I'm having trouble understanding that. Could you try rephrasing?";
    }
}
      
       
        else {
                try {
                    const response = await fetch(`https://your-api-endpoint/generate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({ 
                            model: modelName,
                            input: message 
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }

                    const data = await response.json();

                    if (!data.response || data.response.toLowerCase().includes('error') || data.response.trim() === message.trim()) {
                        return "I'm not sure I understand. Could you phrase it differently?";
                    }

                    return data.response;
                } catch (error) {
                    console.error('Error fetching GPT-2 response:', error);
                    return "I encountered an error while processing your request. Please try again in a moment.";
                }
            }
        }

        async function systemInfoRequest() {
            try {
                const response = await fetch(`https://your-api-endpoint/system-info`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                return JSON.stringify(data, null, 2);
            } catch (error) {
                console.error('Error fetching system info:', error);
                return "Unable to fetch system information.";
            }
        }

        function handleUserInput() {
            const message = userInput.value.trim();
            if (message) {
                addMessage('You', message);
                userInput.value = '';

                setTimeout(async () => {
                    let response = '';

                    if (message.toLowerCase().includes('hello')) {
                        response = 'Hello! How can I assist you today?';
                    } else if (message.toLowerCase().includes('your name')) {
                        response = "I'm your friendly chatbot!";
                    } else if (message.toLowerCase().includes('help')) {
                        response = "You can ask me to perform tasks like counting, math operations, or even sharing trivia.";
                    } else if (message.toLowerCase().includes('capabilities')) {
                        response = "I can chat, count, perform math operations, share trivia, handle URLs, and remember recent parts of our conversation!";
                    } else if (message.toLowerCase().includes('remember') || message.toLowerCase().includes('recent')) {
                        response = recallMemory();
                    } else if (message.toLowerCase().includes('alphabet')) {
                        response = "The alphabet starts with A, B, C...and goes all the way to Z!";

                    // Math operations
                    } else if (message.match(/(\d+)\s*\+\s*(\d+)/)) {
                        const [_, num1, num2] = message.match(/(\d+)\s*\+\s*(\d+)/);
                        response = `${num1} + ${num2} = ${parseInt(num1) + parseInt(num2)}`;
                    } else if (message.match(/(\d+)\s*\-\s*(\d+)/)) {
                        const [_, num1, num2] = message.match(/(\d+)\s*\-\s*(\d+)/);
                        response = `${num1} - ${num2} = ${parseInt(num1) - parseInt(num2)}`;
                    } else if (message.match(/(\d+)\s*\/\s*(\d+)/)) {
                        const [_, num1, num2] = message.match(/(\d+)\s*\/\s*(\d+)/);
                        response = num2 == 0 ? "I can't divide by zero!" : `${num1} / ${num2} = ${(parseInt(num1) / parseInt(num2)).toFixed(2)}`;
                    } else if (message.match(/(\d+)\s*\*\s*(\d+)/)) {
                        const [_, num1, num2] = message.match(/(\d+)\s*\*\s*(\d+)/);
                        response = `${num1} * ${num2} = ${num1 * num2}`;
                    } else if (message.toLowerCase().includes('square root')) {
                        const match = message.match(/square root of (\d+)/);
                        if (match) {
                            const number = parseInt(match[1], 10);
                            response = `The square root of ${number} is approximately ${Math.sqrt(number).toFixed(2)}`;
                        } else {
                            response = "I can't calculate that. Try 'square root of [number]'.";
                        }

                    // Trivia
            let triviaUsed = [];

function getTrivia() {
    const triviaFacts = [
        "Did you know? Honey never spoils and can last thousands of years!",
        "Fun fact: Octopuses have three hearts.",
        "Here’s a cool fact: Bananas are berries, but strawberries aren’t!",
        "Did you know? A day on Venus is longer than a year on Venus!",
        "Fun fact: Humans share 60% of their DNA with bananas."
    ];

    // Refill triviaUsed if all facts have been used
    if (triviaUsed.length === triviaFacts.length) triviaUsed = [];

    // Filter to get only unused facts, then select one
    const availableFacts = triviaFacts.filter(fact => !triviaUsed.includes(fact));
    const fact = availableFacts[Math.floor(Math.random() * availableFacts.length)];

    triviaUsed.push(fact);  // Mark fact as used
    return fact;
}

                    } else if (message.toLowerCase().includes('system info')) {
                        response = await systemInfoRequest();
                    
                    // Custom countdown handler
                    } else {
                        const countdownResult = handleCountdown(message);
                        if (countdownResult) {
                            response = countdownResult;
                        } else {
                            // Send to GPT-2 model for further processing
                            response = await botResponse(message);
                        }
                    }

                    addMessage('Bot', response);
                    addToMemory(message, response);
                }, 500);
            }
        }

        sendButton.addEventListener('click', handleUserInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleUserInput();
            }
        });
    </script>
</body>
</html>
