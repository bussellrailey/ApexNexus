<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApexNexus Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #chatWindow {
            border: 1px solid black;
            padding: 10px;
            height: 300px;
            overflow-y: scroll;
            margin-bottom: 10px;
        }
        input[type="text"] {
            width: 80%;
        }
    </style>
</head>
<body>
    <div id="chatWindow"></div>
    <input id="messageInput" type="text" placeholder="Type a message...">
    <button id="sendButton">Send</button>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const sendButton = document.getElementById('sendButton');
            const messageInput = document.getElementById('messageInput');
            const chatWindow = document.getElementById('chatWindow');

            sendButton.addEventListener('click', async () => {
                const userMessage = messageInput.value;
                if (userMessage) {
                    chatWindow.innerHTML += `<p><strong>You:</strong> ${userMessage}</p>`;
                    messageInput.value = ''; // Clear input field after sending

                    try {
                        const botResponse = await fetch('https://api-inference.huggingface.co/models/gpt2', {
                            headers: {
                                Authorization: `Bearer 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`, // Your API key
                                'Content-Type': 'application/json'
                            },
                            method: 'POST',
                            body: JSON.stringify({ inputs: userMessage }),
                        });

                        console.log('Response Status:', botResponse.status); // Log status code
                        
                        if (!botResponse.ok) {
                            throw new Error(`API responded with status: ${botResponse.status} - ${botResponse.statusText}`);
                        }

                        const responseText = await botResponse.text();
                        console.log('Raw response:', responseText); // Log the raw response

                        try {
                            const data = JSON.parse(responseText);
                            console.log('Parsed data:', data); // Log parsed data
                            
                            // Accessing the generated_text from the first object
                            if (data && Array.isArray(data) && data.length > 0 && data[0].generated_text) {
                                chatWindow.innerHTML += `<p><strong>Bot:</strong> ${data[0].generated_text}</p>`; // Access generated_text correctly
                            } else {
                                chatWindow.innerHTML += `<p><strong>Error:</strong> Unexpected response format</p>`;
                            }
                        } catch (parseError) {
                            throw new Error('Failed to parse response: ' + parseError.message);
                        }
                    } catch (error) {
                        chatWindow.innerHTML += `<p><strong>Error:</strong> ${error.message}</p>`;
                        console.error('Error:', error);
                    }
                }
            });
        });
    </script>
</body>
</html>
